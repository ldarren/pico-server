DROP DATABASE `hh`;
CREATE DATABASE IF NOT EXISTS `hh` DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_unicode_ci;

USE `hh`;

SET storage_engine=INNODB;

CREATE TABLE IF NOT EXISTS `patient`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) NOT NULL,
    `ic` VARCHAR(16) NOT NULL,
    `wardId` BIGINT NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE KEY (`ic`),
    KEY (`name`),
    KEY (`wardId`)
);

CREATE TABLE IF NOT EXISTS `ward`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) NOT NULL,
    `specialty` VARCHAR(32) NOT NULL,
    `subSpecialty` VARCHAR(32) NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
);

CREATE TABLE IF NOT EXISTS `doctor`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) NOT NULL,
    `ic` VARCHAR(16) NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY (`name`)
);

CREATE TABLE IF NOT EXISTS `issue`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `desc` VARCHAR(128) NOT NULL,
    `patientId` BIGINT NOT NULL,
    `doctorId` BIGINT NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY (`patientId`),
    KEY (`doctorId`)
);

CREATE TABLE IF NOT EXISTS `transfer`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `issueId` BIGINT NOT NULL,
    `requestedId` BIGINT NOT NULL,
    `requesterId` BIGINT NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY (`requestedId`)
);

CREATE TABLE IF NOT EXISTS `result`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `desc` VARCHAR(128) NOT NULL,
    `issueId` BIGINT NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY (`issueId`)
);

CREATE TABLE IF NOT EXISTS `history`(
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `patientId` BIGINT NOT NULL,
    `doctorId` BIGINT NOT NULL,
    `issueId` BIGINT NOT NULL,
    `reportId` BIGINT NOT NULL,
    `status` TINYINT DEFAULT 1,
    `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY (`patientId`)
);
